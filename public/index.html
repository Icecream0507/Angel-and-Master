<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天使与主人</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="container" id="login-screen">
        <h1>天使与主人</h1>
        <p>输入你的昵称，加入游戏！</p>
        <input type="text" id="nickname-input" placeholder="输入昵称">
        <button id="join-button">加入游戏</button>
    </div>

    <div class="container hidden" id="game-screen">
        <h2 id="game-title">游戏进行中...</h2>
        <div id="master-info">
            <p>你的主人是: <span id="master-name"></span></p>
        </div>
        <div id="wish-form">
            <h3>许下你的愿望（最多3个）</h3>
            <input type="text" id="wish-input" placeholder="输入你的愿望...">
            <button id="add-wish-button">添加愿望</button>
            <ul id="wish-list"></ul>
        </div>
        <p id="status-message"></p>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const loginScreen = document.getElementById('login-screen');
        const gameScreen = document.getElementById('game-screen');
        const nicknameInput = document.getElementById('nickname-input');
        const joinButton = document.getElementById('join-button');
        const masterNameSpan = document.getElementById('master-name');
        const wishInput = document.getElementById('wish-input');
        const addWishButton = document.getElementById('add-wish-button');
        const wishList = document.getElementById('wish-list');
        const statusMessage = document.getElementById('status-message');

        let isGameStarted = false;

        joinButton.addEventListener('click', () => {
            const nickname = nicknameInput.value.trim();
            if (nickname) {
                socket.emit('join', nickname);
                loginScreen.classList.add('hidden');
                statusMessage.textContent = '正在等待其他玩家...';
            }
        });

        addWishButton.addEventListener('click', () => {
            const wish = wishInput.value.trim();
            if (wish) {
                socket.emit('add_wish', {
                    wish: wish
                });
                const li = document.createElement('li');
                li.textContent = wish;
                wishList.appendChild(li);
                wishInput.value = '';
            }
        });

        socket.on('start_game', (data) => {
            if (data.isGameStarted) {
                gameScreen.classList.remove('hidden');
                masterNameSpan.textContent = data.masterName;
                statusMessage.textContent = '游戏已开始！快去许愿吧！';
                isGameStarted = true;
            }
        });

        socket.on('game_status', (msg) => {
            if (!isGameStarted) {
                statusMessage.textContent = msg;
            }
        });
    </script>
</body>
</html>