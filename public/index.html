<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©ä½¿ä¸ä¸»äºº</title>
    <style>
        body { font-family: sans-serif; text-align: center; margin-top: 50px; background-color: #f4f4f9; color: #333; }
        .container { max-width: 600px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 12px; background-color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        input, button { padding: 12px; margin: 8px; width: 80%; max-width: 300px; border-radius: 6px; border: 1px solid #ddd; font-size: 16px; }
        button { cursor: pointer; background-color: #007BFF; color: white; border: none; transition: background-color 0.3s ease; }
        button:hover { background-color: #0056b3; }
        #room-id-display { font-size: 24px; color: #007BFF; font-weight: bold; }
        #player-list { list-style: none; padding: 0; }
        #player-list li { padding: 10px; border-bottom: 1px solid #eee; }
        #message-display { color: #d9534f; margin: 10px 0; font-weight: bold; }
        #lobby-view #start-game-btn,
        #game-view-tasks #end-game-btn {
            display: block;
            margin: 20px auto;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 10px;
            position: relative;
        }
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            right: 15px;
            top: 5px;
        }
        .close-btn:hover,
        .close-btn:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        #relationship-canvas {
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .footer {
            text-align: center; 
            color: #888; 
            font-size: 12px; 
            margin-top: 50px;
        }
    </style>
</head>
<body>

    <div id="app" class="container">
        <h1>å¤©ä½¿ä¸ä¸»äºº</h1>
        <h2>ğŸ‘¼&ğŸ‘¨</h2>
        <h3>äº¤å¤§é‡åæ¬¢è¿ä½ ï¼</h3>

        <p id="message-display"></p>

        <div id="home-view">
            <button onclick="showCreateRoom()">æˆ‘æ˜¯æˆ¿ä¸»</button>
            <button onclick="showJoinRoom()">æˆ‘æ˜¯é˜Ÿå‘˜</button>
            <br>
            <br>
            <button onclick="showRulesModal()">æ¸¸æˆè§„åˆ™</button>
            <button onclick="clearRoomData()">æ¸…é™¤æ‰€æœ‰æˆ¿é—´æ•°æ®</button>
            <br>
            <button onclick="showSponsorModal()">èµåŠ©æˆ‘ä»¬</button>
        </div>

        <div id="create-room-view" style="display:none;">
            <button onclick="showView('home-view')">è¿”å›</button>
            <h2>åˆ›å»ºæˆ¿é—´</h2>
            <input type="text" id="owner-name" placeholder="è¾“å…¥ä½ çš„æ˜µç§°/åå­—">
            <button onclick="createRoom()">åˆ›å»ºæˆ¿é—´</button>
        </div>

        <div id="join-room-view" style="display:none;">
            <button onclick="showView('home-view')">è¿”å›</button>
            <h2>åŠ å…¥æˆ¿é—´</h2>
            <input type="text" id="join-room-id" placeholder="è¾“å…¥æˆ¿é—´å·">
            <input type="text" id="join-player-name" placeholder="è¾“å…¥ä½ çš„æ˜µç§°/åå­—">
            <button onclick="joinRoom()">åŠ å…¥æˆ¿é—´</button>
        </div>

        <div id="lobby-view" style="display:none;">
            <button onclick="showView('home-view')">è¿”å›</button>
            <h2>æ¸¸æˆå¤§å…</h2>
            <p>æˆ¿é—´å·: <span id="lobby-room-id"></span></p>
            <p>å½“å‰äººæ•°: <span id="player-count">0</span></p>
            <h3>ç©å®¶åˆ—è¡¨:</h3>
            <ul id="player-list"></ul>
            <button id="start-game-btn" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
        </div>

        <div id="game-view-wishes" style="display:none;">
            <h2>æäº¤ä½ çš„æ„¿æœ›</h2>
            <p>è¯·æäº¤ä¸‰ä¸ªæ„¿æœ›ï¼Œè®©ä½ çš„å¤©ä½¿ä¸ºä½ å®ç°ã€‚</p>
            <input type="text" id="wish1" placeholder="æ„¿æœ›1">
            <input type="text" id="wish2" placeholder="æ„¿æœ›2">
            <input type="text" id="wish3" placeholder="æ„¿æœ›3">
            <button onclick="submitWishes()">æäº¤æ„¿æœ›</button>
        </div>

        <div id="game-view-tasks" style="display:none;">
            <h2>ä½ çš„ä¸»äººä¸ä»»åŠ¡</h2>
            <p>ä½ çš„ä¸»äººæ˜¯: <span id="my-owner-name"></span></p>
            <h3>ä½ çš„ä»»åŠ¡:</h3>
            <ul id="my-tasks-list"></ul>
            <button id="end-game-btn" onclick="endGame()">ç»“æŸæ¸¸æˆ</button>
        </div>

        <div id="game-view-results" style="display:none;">
            <h2>æ¸¸æˆç»“æœä¸äººç‰©å…³ç³»</h2>
            <p>ç‚¹å‡»äººç‰©åœ†åœˆæŸ¥çœ‹taçš„æ„¿æœ›ã€‚</p>
            <canvas id="relationship-canvas"></canvas>
        </div>
        
    </div>

    <div id="wishes-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeWishesModal()">&times;</span>
            <h3 id="wishes-modal-title"></h3>
            <ul id="wishes-modal-list"></ul>
        </div>
    </div>

    <div id="rules-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeRulesModal()">&times;</span>
            <h2>æ¸¸æˆè§„åˆ™</h2>
            <p>å¤©ä½¿ğŸ‘¼ä¸ä¸»äººğŸ‘¨</p>
            <ul>
                <li>ç©å®¶åˆ›å»ºæˆ¿é—´æˆ–åŠ å…¥æˆ¿é—´ã€‚</li>
                <li>æˆ¿ä¸»é‡æ–°åŠ å…¥æˆ¿é—´ï¼Œè¯·ä½¿ç”¨ç›¸åŒçš„æ˜µç§°ä»¥ç©å®¶èº«ä»½è¿›å…¥ã€‚</li>
                <li>å½“æ‰€æœ‰ç©å®¶å°±ç»ªåï¼Œæˆ¿ä¸»å¼€å§‹æ¸¸æˆã€‚</li>
                <li>ç³»ç»Ÿä¼šç§˜å¯†åœ°ä¸ºæ¯ä¸ªç©å®¶åˆ†é…ä¸€ä¸ª*å¤©ä½¿*å’Œä¸€ä¸ª*ä¸»äºº*ã€‚</li>
                <li>ç©å®¶å¯ä»¥æäº¤è‡³å¤š3ä¸ªæ„¿æœ›ã€‚</li>
                <li>ä¸€æ—¦æ‰€æœ‰äººéƒ½æäº¤äº†æ„¿æœ›ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°ä½ çš„ä¸»äººçš„æ„¿æœ›æ¸…å•ã€‚ä½ çš„ä»»åŠ¡æ˜¯å°½åŠ›å»å®Œæˆä½ çš„ä¸»äººçš„æ„¿æœ›ï¼Œè€Œä½ çš„å¤©ä½¿åˆ™ä¼šå°½åŠ›å®Œæˆä½ çš„æ„¿æœ›ã€‚</li>
                <li>æ¸¸æˆæ²¡æœ‰æ—¶é—´é™åˆ¶ï¼Œå½“æˆ¿ä¸»è®¤ä¸ºä»»åŠ¡éƒ½å·²å®Œæˆæ—¶ï¼Œå¯ä»¥ç»“æŸæ¸¸æˆã€‚</li>
                <li>æ¸¸æˆç»“æŸåï¼Œæ‰€æœ‰ç©å®¶çš„çœŸå®å…³ç³»å°†è¢«æ­æ™“ï¼è®©æˆ‘çœ‹çœ‹è°æ²¡å®Œæˆä»»åŠ¡ğŸ¤¬</li>
                <li>inspired by DT, technically supported by IcecreamğŸ¦, äº¤å¤§é‡å ,SJTU ,ä¸Šæµ· , ä¸­å›½</li>
            </ul>
        </div>
    </div>

    <div id="sponsor-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeSponsorModal()">&times;</span>
            <h2>ç‰¹åˆ«é¸£è°¢</h2>
            <p>æ„Ÿè°¢äº¤å¤§é‡åå¯¹æœ¬æ¸¸æˆçš„å¤§åŠ›æ”¯æŒï¼</p>
            <p>ä¸ºçˆ±å‘ç”µing......</p>
        </div>
    </div>

    <script>
        // APIåŸºç¡€URL
        const API_URL = 'http://127.0.0.1:5000/';

        // æ¸¸æˆçŠ¶æ€å˜é‡
        let currentRoomId = '';
        let currentPlayerName = '';
        let isOwner = false;
        let lobbyIntervalId = null;
        let wishesIntervalId = null;
        let gameStatusIntervalId = null;
        let playerPositions = {}; 

        // æ˜¾ç¤ºç‰¹å®šè§†å›¾
        function showView(viewId) {
            document.querySelectorAll('#app > div').forEach(div => {
                div.style.display = 'none';
            });
            document.getElementById(viewId).style.display = 'block';
        }

        // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
        function showMessage(msg) {
            document.getElementById('message-display').textContent = msg;
            setTimeout(() => {
                document.getElementById('message-display').textContent = '';
            }, 3000); 
        }

        // åˆ‡æ¢è§†å›¾å‡½æ•°
        function showCreateRoom() { showView('create-room-view'); }
        function showJoinRoom() { showView('join-room-view'); }
        function showWishesModal() { document.getElementById('wishes-modal').style.display = 'block'; }
        function closeWishesModal() { document.getElementById('wishes-modal').style.display = 'none'; }
        function showRulesModal() { document.getElementById('rules-modal').style.display = 'block'; }
        function closeRulesModal() { document.getElementById('rules-modal').style.display = 'none'; }
        // æ–°å¢èµåŠ©æ¨¡æ€çª—å£æ§åˆ¶å‡½æ•°
        function showSponsorModal() { document.getElementById('sponsor-modal').style.display = 'block'; }
        function closeSponsorModal() { document.getElementById('sponsor-modal').style.display = 'none'; }

        // åˆ›å»ºæˆ¿é—´
        async function createRoom() {
            const ownerName = document.getElementById('owner-name').value;
            if (!ownerName) {
                showMessage('è¯·è¾“å…¥ä½ çš„æ˜µç§°');
                return;
            }
            try {
                const payload = { owner_name: ownerName };
                const response = await fetch(`${API_URL}/create_room`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                if (data.success) {
                    currentRoomId = data.room_id;
                    currentPlayerName = ownerName;
                    isOwner = true;
                    showMessage('æˆ¿é—´åˆ›å»ºæˆåŠŸ! æˆ¿é—´å·: ' + currentRoomId);
                    showLobby();
                } else {
                    showMessage('åˆ›å»ºæˆ¿é—´å¤±è´¥: ' + data.message);
                }
            } catch (error) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
            }
        }

        // åŠ å…¥æˆ¿é—´
        async function joinRoom() {
            const roomId = document.getElementById('join-room-id').value;
            const playerName = document.getElementById('join-player-name').value;
            if (!roomId || !playerName) {
                showMessage('è¯·è¾“å…¥æˆ¿é—´å·å’Œæ˜µç§°');
                return;
            }
            try {
                const payload = { room_id: roomId, player_name: playerName };
                const response = await fetch(`${API_URL}/join_room`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                if (data.message === 'æˆ¿ä¸»å†æ¬¡è¿›å…¥æˆ¿é—´') {
                    currentRoomId = roomId;
                    currentPlayerName = playerName;
                    isOwner = true;
                    showMessage('æ¬¢è¿å›æ¥ï¼Œæˆ¿ä¸»!');
                    showLobby();
                    return;
                }
                if (data.success) {
                    currentRoomId = roomId;
                    currentPlayerName = playerName;
                    isOwner = false;
                    showMessage('åŠ å…¥æˆ¿é—´æˆåŠŸ!');
                    showLobby();
                } else {
                    showMessage('åŠ å…¥æˆ¿é—´å¤±è´¥: ' + data.message);
                }
            } catch (error) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
            }
        }

        // æ˜¾ç¤ºå¤§å…è§†å›¾
        function showLobby() {
            if (!currentRoomId) { return; }
            showView('lobby-view');
            document.getElementById('lobby-room-id').textContent = currentRoomId;
            document.getElementById('start-game-btn').style.display = isOwner ? 'block' : 'none';

            if (lobbyIntervalId) { clearInterval(lobbyIntervalId); }
            lobbyIntervalId = setInterval(async () => {
                const response = await fetch(`${API_URL}/get_room_info/${currentRoomId}`);
                const data = await response.json();
                if (data.success) {
                    const playerList = document.getElementById('player-list');
                    playerList.innerHTML = '';
                    data.players.forEach(p => {
                        const li = document.createElement('li');
                        li.textContent = p;
                        playerList.appendChild(li);
                    });
                    document.getElementById('player-count').textContent = data.players.length;

                    if (data.status === 'in_game') {
                        clearInterval(lobbyIntervalId);
                        showGameWishes();
                    }
                }
            }, 3000);
        }
        
        // å¼€å§‹æ¸¸æˆ
        async function startGame() {
            try {
                const payload = { room_id: currentRoomId };
                const response = await fetch(`${API_URL}/start_game`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                if (data.success) {
                    showMessage('æ¸¸æˆå¼€å§‹ï¼');
                    showGameWishes(); 
                } else {
                    showMessage('å¼€å§‹æ¸¸æˆå¤±è´¥: ' + data.message);
                }
            } catch (error) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
            }
        }

        // æ˜¾ç¤ºæ„¿æœ›æäº¤è§†å›¾
        function showGameWishes() {
            showView('game-view-wishes');
            document.getElementById('wish1').value = '';
            document.getElementById('wish2').value = '';
            document.getElementById('wish3').value = '';

            if (wishesIntervalId) { clearInterval(wishesIntervalId); }
            wishesIntervalId = setInterval(async () => {
                const allWishesSubmittedResponse = await fetch(`${API_URL}/check_all_wishes/${currentRoomId}`);
                const allWishesSubmittedData = await allWishesSubmittedResponse.json();
                
                if (allWishesSubmittedData.all_submitted) {
                    clearInterval(wishesIntervalId); 
                    showGameTasks();
                }
            }, 3000); 
        }

        // æäº¤æ„¿æœ›
        async function submitWishes() {
            const wishes = [
                document.getElementById('wish1').value,
                document.getElementById('wish2').value,
                document.getElementById('wish3').value
            ].filter(w => w);

            if (wishes.length === 0) {
                showMessage('è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªæ„¿æœ›ï¼');
                return;
            }
            
            try {
                const payload = { room_id: currentRoomId, player_name: currentPlayerName, wishes: wishes };
                const response = await fetch(`${API_URL}/submit_wishes`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                if (data.success) {
                    showMessage('æ„¿æœ›æäº¤æˆåŠŸï¼Œç­‰å¾…æ‰€æœ‰ç©å®¶æäº¤ã€‚');
                } else {
                    showMessage('æäº¤å¤±è´¥: ' + data.message);
                }
            } catch (error) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
            }
        }

        // æ˜¾ç¤ºä»»åŠ¡è§†å›¾
        async function showGameTasks() {
            showView('game-view-tasks');
            document.getElementById('end-game-btn').style.display = isOwner ? 'block' : 'none';

            try {
                const response = await fetch(`${API_URL}/get_my_owner/${currentRoomId}/${currentPlayerName}`);
                const data = await response.json();
                if (data.success) {
                    document.getElementById('my-owner-name').textContent = data.owner_name;
                    const taskList = document.getElementById('my-tasks-list');
                    taskList.innerHTML = '';
                    data.tasks.forEach(task => {
                        const li = document.createElement('li');
                        li.textContent = task;
                        taskList.appendChild(li);
                    });
                } else {
                    showMessage('è·å–ä»»åŠ¡å¤±è´¥: ' + data.message);
                }
            } catch (error) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
            }

            if (gameStatusIntervalId) { clearInterval(gameStatusIntervalId); }
            gameStatusIntervalId = setInterval(async () => {
                const response = await fetch(`${API_URL}/get_room_info/${currentRoomId}`);
                const data = await response.json();
                if (data.success && data.status === 'game_over') { // æ£€æŸ¥'game_over'çŠ¶æ€
                    clearInterval(gameStatusIntervalId);
                    showResults();
                }
            }, 3000);
        }

        // ç»“æŸæ¸¸æˆ
        async function endGame() {
            try {
                const payload = { room_id: currentRoomId, player_name: currentPlayerName }; // åŒ…å«ç©å®¶åè¿›è¡ŒéªŒè¯
                const response = await fetch(`${API_URL}/end_game`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                if (data.success) {
                    showMessage('æ¸¸æˆå·²ç»“æŸï¼');
                    showResults();
                } else {
                    showMessage('ç»“æŸæ¸¸æˆå¤±è´¥: ' + data.message);
                }
            } catch (error) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
            }
        }

        // æ˜¾ç¤ºæ¸¸æˆç»“æœ
        async function showResults() {
            showView('game-view-results');
            try {
                const response = await fetch(`${API_URL}/get_all_relationships/${currentRoomId}`); // è°ƒç”¨æ–°ç«¯ç‚¹
                const data = await response.json();
                if (data.success) {
                    drawRelationships(data.relationships);
                } else {
                    showMessage('è·å–æ¸¸æˆç»“æœå¤±è´¥: ' + data.message);
                }
            } catch (error) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
            }
        }

        // ç»˜åˆ¶å…³ç³»å›¾
        function drawRelationships(relationships) {
            const canvas = document.getElementById('relationship-canvas');
            const ctx = canvas.getContext('2d');

            const containerWidth = canvas.parentElement.clientWidth;
            canvas.width = containerWidth > 600 ? 600 : containerWidth;
            canvas.height = 400;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const players = Object.keys(relationships);
            if (players.length === 0) return;

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 50;
            const angleStep = (2 * Math.PI) / players.length;
            const nodeRadius = 25;
            playerPositions = {};

            // ç»˜åˆ¶ç©å®¶èŠ‚ç‚¹
            players.forEach((player, index) => {
                const angle = index * angleStep - Math.PI / 2; 
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);

                playerPositions[player] = { x, y };

                ctx.beginPath();
                ctx.arc(x, y, nodeRadius, 0, 2 * Math.PI);
                ctx.fillStyle = '#007BFF';
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.fillStyle = '#333';
                ctx.font = 'bold 14px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(player, x, y);
            });

            // ç»˜åˆ¶å…³ç³»çº¿å’Œç®­å¤´
            for (const angel in relationships) {
                const owner = relationships[angel];
                const startPos = playerPositions[owner];
                const endPos = playerPositions[angel];

                if (startPos && endPos) {
                    ctx.beginPath();
                    ctx.moveTo(startPos.x, startPos.y);
                    ctx.lineTo(endPos.x, endPos.y);
                    ctx.strokeStyle = '#555';
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    const headlen = 10;
                    const dx = endPos.x - startPos.x;
                    const dy = endPos.y - startPos.y;
                    const angle = Math.atan2(dy, dx);

                    const endX = endPos.x - nodeRadius * Math.cos(angle);
                    const endY = endPos.y - nodeRadius * Math.sin(angle);

                    ctx.beginPath();
                    ctx.moveTo(endX, endY);
                    ctx.lineTo(endX - headlen * Math.cos(angle - Math.PI / 6), endY - headlen * Math.sin(angle - Math.PI / 6));
                    ctx.moveTo(endX, endY);
                    ctx.lineTo(endX - headlen * Math.cos(angle + Math.PI / 6), endY - headlen * Math.sin(angle + Math.PI / 6));
                    ctx.strokeStyle = '#555';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }

            // ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œæ˜¾ç¤ºç©å®¶æ„¿æœ›
            canvas.onclick = (event) => {
                const rect = canvas.getBoundingClientRect();
                const mouseX = event.clientX - rect.left;
                const mouseY = event.clientY - rect.top;

                for (const player in playerPositions) {
                    const pos = playerPositions[player];
                    const distance = Math.sqrt(Math.pow(mouseX - pos.x, 2) + Math.pow(mouseY - pos.y, 2));

                    if (distance <= nodeRadius) {
                        showPlayerWishes(player);
                        return;
                    }
                }
            };
        }

        // æ˜¾ç¤ºç©å®¶çš„æ„¿æœ›
        async function showPlayerWishes(playerName) {
            try {
                const response = await fetch(`${API_URL}/get_wishes/${currentRoomId}/${playerName}`);
                const data = await response.json();
                if (data.success) {
                    const wishesList = document.getElementById('wishes-modal-list');
                    wishesList.innerHTML = '';
                    document.getElementById('wishes-modal-title').textContent = `${playerName} çš„æ„¿æœ›`;
                    data.wishes.forEach(wish => {
                        const li = document.createElement('li');
                        li.textContent = wish;
                        wishesList.appendChild(li);
                    });
                    showWishesModal();
                } else {
                    showMessage('è·å–æ„¿æœ›å¤±è´¥: ' + data.message);
                }
            } catch (error) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
            }
        }

        // æ¸…é™¤æ‰€æœ‰æˆ¿é—´æ•°æ®
        async function clearRoomData() {
            try {
                const response = await fetch(`${API_URL}/clear_all_data`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const data = await response.json();
                if (data.success) {
                    showMessage('æ‰€æœ‰æˆ¿é—´æ•°æ®å·²æˆåŠŸæ¸…é™¤ï¼');
                    currentRoomId = '';
                    currentPlayerName = '';
                    isOwner = false;
                    if (lobbyIntervalId) { clearInterval(lobbyIntervalId); }
                    if (wishesIntervalId) { clearInterval(wishesIntervalId); }
                    if (gameStatusIntervalId) { clearInterval(gameStatusIntervalId); }
                    showView('home-view');
                } else {
                    showMessage('æ¸…é™¤æ‰€æœ‰æ•°æ®å¤±è´¥: ' + data.message);
                }
            } catch (error) {
                showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
            }
        }
    </script>
    <div class="footer">
        ç³•ç ” v1.0
    </div>
</body>
</html>